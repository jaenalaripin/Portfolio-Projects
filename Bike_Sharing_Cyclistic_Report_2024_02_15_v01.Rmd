---
title: "Bike-Share Cyclistic Analysis"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(readr) 
library(janitor) 
library(tidyverse)
library(extrafont)             #loading extrafont package
loadfonts(device = "win")      #registering font from windows into RStudio
library(knitr)
```

![](https://i.imgur.com/HyU3U5b.png)

### 1. Business Task
Cyclistic have two types of users. First one is casual users that includes single-ride and full-day passes users and the second one is annual members. This analysis will help you answer this question:

* How do annual members and casual riders use Cyclistic bikes differently?

### 2. Data Source
We used Cyclisticâ€™s historical trip data to analyze and identify trends. We downloaded the previous 12 months of Cyclistic trip data [here](https://divvy-tripdata.s3.amazonaws.com/index.html). (Note: The datasets have a different name because Cyclistic is a fictional company. For the purposes of this case study, the datasets are appropriate and will enable us to answer the business questions. The data has been made available by Motivate International Inc. under this [license](https://divvybikes.com/data-license-agreement).) We downloaded only the data sets from 2019. The data are divided into 4 quarters per year. In this analysis, we only include the transaction report in 2019, which spread to 4 separate data sets (Q1, Q2, Q3, and Q4).

### 3. Cleaning and Manipulation of Data
#### 3.1. Importing Data Sets
Our datasets are not clean. We have to perform some cleaning and manipulation processes so they can be used for further analysis. 

We use RStudio to perform all the processes, from importing, cleaning, analyzing, visualizing, and reporting. First step is the importing process. Here, we prepare the data we want to use for analysis. The datasets are divided into 4 separate files. We use `read_csv` function from `readr` package to import external csv files. Here is the code to import all of them:

```{r import, echo=TRUE, message = FALSE, warning = FALSE}
library(readr)        #loading readr package to enable read_csv function                                                              
bike2019 <- read_csv("F:/Data Analytics/Case Studies/Bike Share/R/Divvy_Trips_2019_Q1.csv")        #importing dataset of Q1
bike20192 <- read_csv("F:/Data Analytics/Case Studies/Bike Share/R/Divvy_Trips_2019_Q2.csv")       #importing dataset of Q2
bike20193 <- read_csv("F:/Data Analytics/Case Studies/Bike Share/R/Divvy_Trips_2019_Q3.csv")       #importing dataset of Q3
bike20194 <- read_csv("F:/Data Analytics/Case Studies/Bike Share/R/Divvy_Trips_2019_Q4.csv")       #importing dataset of Q4
```

#### 3.2. Cleaning Data Sets
These four files need to be merged into one data set for further analysis. Before that, we need to check the preview of each data set with `glimpse` function from the `dplyr` package.

```{r structure, echo=TRUE}
library(dplyr)
glimpse(bike2019)     #checking the structure of Q1 data set
glimpse(bike20192)    #checking the structure of Q2 data set
glimpse(bike20193)    #checking the structure of Q3 data set
glimpse(bike20194)    #checking the structure of Q4 data set
```

All data sets consist of twelve columns and the same value type from all of them, but we see that only the Q2 data set contains different column names, which does not allow us to join the data sets. Q2 data set has column names with spaces and capital letters. We need to perform `clean_names` function from `janitor` package to transform the column names. 

```{r clean_names, echo=TRUE}
library(janitor)                          #loading janitor package to perform rename_with function
bike20192 <- clean_names(bike20192)       #renaming all the column names of Q2 data set
colnames(bike20192)                       #view Q2 data set column names
```

All Q2 column names have been updated, but the column names are still not the same as the rest of the data set. We wrote this code with the `rename` function from the `dplyr` package to rename Q2 column names, and match them with the columns from the other data sets.

```{r rename, echo=TRUE, message=FALSE, warning=FALSE}
library(dplyr)                                                               #loading the dplyr package
bike20192 <-                                                                 #Renaming Q2 dataset columns
  bike20192 %>% 
  rename(trip_id = x01_rental_details_rental_id,
         start_time = x01_rental_details_local_start_time,
         end_time = x01_rental_details_local_end_time,
         bikeid = x01_rental_details_bike_id,
         tripduration = x01_rental_details_duration_in_seconds_uncapped,
         from_station_id = x03_rental_start_station_id,
         from_station_name = x03_rental_start_station_name,
         to_station_id = x02_rental_end_station_id,
         to_station_name = x02_rental_end_station_name,
         usertype = user_type,
         gender = member_gender,
         birthyear = x05_member_details_member_birthday_year)
```

Here's the preview of Q2 table after the column names have been renamed.

```{r colnamesQ2}
colnames(bike20192)       #checking the column names                                                     
```

All the column names from all datasets are the same. With this, we can join the datasets with `union_all` function from `dplyr` package.

```{r union_all}
bike2019 <- union_all(bike2019, bike20192)          #joining Q1 and Q2
bike2019 <- union_all(bike2019, bike20193)          #joining Q1,Q2 and Q3
bike2019 <- union_all(bike2019, bike20194)          #joining Q1,Q2,Q3, and Q4
```

#### 3.3. Checking Outliers, Duplicates, Typos and Null Values
Now all the data sets have been joined. The next step is to find any outliers, typos and null values in the data set. Here, we want to summary each column with `summary` function.

```{r summary, echo=TRUE}
summary(bike2019)        #view statistical values of the data set
```

We see a weird number in the **birthyear** column. The minimum value in the **birthyear** column is *1759*. We can call this an outlier because people who were born in 1759 would not exist in this century. We also can see the maximum value in the **trip duration** column is *10628400*, meaning that someone rents the bike for *2952* hours. This is an outlier, too.

We have to clean the data set from these outliers. People who use Cyclistic must be below 100 years old and not ride the bike for more than 24 hours. We can filter the data set with the `filter` function from the `dplyr` package like this:

```{r filtering, echo=TRUE}
bike2019 <- 
  bike2019 %>% filter(birthyear > 2019-100, 
                      tripduration < 24*3600)   #filtering the data set from outliers
```

Now, we're checking the duplicates and typos using this code:

```{r duplicates and typos, echo = TRUE}
kable(sum(duplicated(bike2019$trip_id)))                #trip_id should be unique, so no duplicates are allowed in this column
kable(head(bike2019 %>% distinct(usertype)))                 #checking values in usertype column
kable(head(bike2019 %>% distinct(gender)))                    #checking values in gender column
```

There are no duplicates in **trip_id** column. There are two types of users in **usertype**, which are *customer* and *subscriber*. There are null values in **gender** column. In this analysis, we call *customer* as *casual*, and *subscriber* as *annual member*, therefore, we need to rename the **usertype** values with `mutate` function from the `dplyr` package:

```{r renameusertype, echo=TRUE}
bike2019 <- 
  bike2019 %>% 
  mutate(usertype = case_when(usertype == "Subscriber" ~ "Annual Member",   #renaming columns
                              usertype == "Customer" ~ "Casual"))

kable(head(bike2019))
```

We see null values in the **gender** column. We can exclude these null values with the code below.

```{r exclude null, echo = TRUE}
bike2019 <-                            #excluding null from the data set
  bike2019 %>%
  drop_na()
```

### 4. Analysis 
#### 4.1. Adding Days, Months, and Age Columns
Creating new columns like **days**, **months**, and **ages** will help us understand the data better. With the **days** column, we can observe on which days people usually use Cyclistic, both for annual members and casual users. With the **ages** column, we can show the range of ages that use Cyclistic the most. We can use the **months** column to see the distribution of Cyclistic transactions throughout the year. We can add these columns with `mutate` function from the `dplyr` package and use the `lubridate` package to extract months and days from the **start_time** column:

```{r lubridate, include=FALSE}
library(lubridate)
```

```{r adding columns, echo=TRUE, message=FALSE, warning=FALSE}
library(lubridate)
bike2019 <-                                                    #creating new columns (ages, days, and months)
  bike2019 %>%                                             
  mutate(ages = year(now())-birthyear) %>% 
  mutate(days = wday(start_time, label = TRUE)) %>%
  mutate(months = factor(month(start_time, label = TRUE)))
kable(head(bike2019 %>% select(ages, days, months)))           #preview of the new columns
```

#### 4.2. Calculating Total Transactions by Months
Calculating total transactions by months and days allows us to plot them into distribution charts, like histogram. We create a new table with this code so we can plot them later on in a chart:

```{r total transaction, echo=TRUE, message=FALSE, warning=FALSE}
biketransactionheatmap <-                    #calculating transactions by months and days, will be used to plot a heatmap chart
  bike2019 %>%
  group_by(usertype, months, days) %>%
  summarise(total = n())

kable(head(biketransactionheatmap))
```

#### 4.3. Calculating Total Duration Users Spent on Riding Bike
Calculating this variable allows us to compare how long the types of users ride bikes. We use this code to perform the calculation:

```{r durations, echo=TRUE, warning=FALSE, message=FALSE}
bike2019durationday <-                        #calculating average trip duration by days
  bike2019 %>% group_by(usertype,days) %>% 
  summarise(average = mean(tripduration)/60)

kable(head(bike2019durationday))
```

#### 4.4. Calculating Distribution of Age
This allows us to see which age group uses Cyclistic the most.

```{r ages, echo=TRUE, warning=FALSE, message=FALSE}
bike2019ages <-                              #calculating transactions by ages
  bike2019 %>%
  group_by(usertype, ages) %>%
  summarise(total = n())

kable(head(bike2019ages))
```

#### 4.5. Calculating Time Distribution
This will show us the hours people mainly use Cyclistic.

```{r time distribution, echo=TRUE, warning=FALSE, message=FALSE}
bike2019hour <-                                                            #calculating time distribution
  bike2019 %>%
         mutate(start_time = ymd_hms(start_time)) %>%
         mutate(start_time = hms::as_hms(start_time)) %>%
         group_by(start_time,usertype,days) %>% summarise(total = n())

kable(head(bike2019hour))
```

#### 4.6. Calculating Distribution of Genders
Knowing the distribution of genders is important to draw the best decision to advertise the app.To calculate the distribution of genders we use the code as follows:

```{r genders, echo = TRUE, message = FALSE, warning = FALSE}
bikegender <-                   #calculating numbers of each gender
  bike2019 %>% 
  group_by(gender,usertype) %>% 
  summarise(total = n()) 

kable(head(bikegender))
```

### 5. Visualizations
We have done the cleaning and analysis steps. Now, we can visualize the processed data. We have some charts that can give you insight about what happen in the raw data. We use `ggplot2` from `tidyverse` to plot the data into charts. 

#### 5.1. Distribution of Transactions
This chart show us clearer information about distribution of Cyclistic transaction in 2019. Most transactions have been done between April and October.

```{r heatmap of transactions, echo=FALSE, message = FALSE}
library(tidyverse)                                        #loading tidyverse package                                     
bike2019 %>% ggplot(aes(usertype)) + 
  geom_histogram(aes(x = start_time, fill = usertype),
                 stat = "bin", bins = 30, show.legend = FALSE) + 
  theme_minimal() +
  theme(
    text = element_text(family = "Courier New"),
    title = element_text(face = "bold"),
    strip.background = element_blank(), strip.placement = "outside") + 
  labs(
    title = "\nDistribution of Transactions",
    subtitle = "in 2019\n",
    x = "\nMonths",
    y = "Transactions\n" ) + 
    guides(fill = guide_legend(title = "User")) +
    facet_grid(usertype~.) +
    scale_fill_manual(values=c("#00CB98", "#0099cb"))
```

November is the last month of the autumn season. The air starts cooling down and makes bike riding not the best option for commuting. Based on the chart, casual users started not to use Cyclistic as their main option, but we see there are still lots of transactions made by the annual members even until the end of the year.
Annual members pay the membership so they can use Cyclistic throughout the year, so they don't want to miss their opportunity to leverage the benefits of the package they bought. Even in January-April, when the winter occurs, there are still a few transactions made.
Casual users only pay for the service either for single-ride passes or full-day passes. When the winter comes, they prefer to choose other ways to commute.

#### 5.2. Heatmap of Time
We know what months the users mainly use the app. This chart will show us the difference between annual members' and casual users' behavior based on time.

```{r heatmap of Time, echo=FALSE, message = FALSE}
bike2019hour %>% filter(usertype == "Annual Member") %>%
 ggplot(aes(x = days, y = start_time, fill = total)) + 
  geom_tile() +
  scale_fill_gradient(low = "white", high = "#00CB98") +
  theme_minimal() +
  theme(
    text = element_text(family = "Courier New"),
    title = element_text(face = "bold"),
    strip.background = element_blank(), strip.placement = "outside") + 
  labs(
    title = "Annual Member\n",
    x = "\nDays",
    y = "Time\n" ) +
  guides(fill = guide_legend(title = "Transactions")) 

bike2019hour %>% filter(usertype == "Casual") %>%
 ggplot(aes(x = days, y = start_time, fill = total)) + 
  geom_tile() +
  scale_fill_gradient(low = "white", high = "#0099cb") +
  theme_minimal() +
  theme(
    text = element_text(family = "Courier New"),
    title = element_text(face = "bold"),
    strip.background = element_blank(), strip.placement = "outside") + 
  labs(
    title = "Casual User\n",
    x = "\nDays",
    y = "Time\n" ) +
  guides(fill = guide_legend(title = "Transactions")) 
```

Annual members mainly use Cyclistic on the weekdays at 07:00-08:00 and 16:00-19:00, while casual users mainly use the app on the weekends at 09:00-19:00.
This tells us that most annual members use Cyclistic for commuting to work, while casual users mainly use Cyclistic for other purposes. We can say that Cyclistic members are mainly workers, while casual users are vary.

#### 5.3. Distribution of Users' Age
This chart will inform us about the age distribution between the two types of users.

```{r distributions of users age, echo = FALSE, message = FALSE}
bike2019 %>% filter(ages < 80) %>% ggplot() + 
  geom_histogram(aes(x = ages, fill = usertype), stat = "bin", bins = 30, show.legend = FALSE) + 
  theme_minimal() +
  theme(
    text = element_text(family = "Courier New"),
    title = element_text(face = "bold"),
    strip.background = element_blank(), strip.placement = "outside") + 
  labs(
    title = "\nDistribution of Users' Age",
    x = "\nAge",
    y = "Transactions\n" ) + 
  guides(fill = guide_legend(title = "User")) +
  facet_grid(.~usertype) +
  scale_fill_manual(values=c("#00CB98", "#0099cb"))
```

Both types of users have the same age distribution. Most Cyclistic users are aged between 25 - 35.

#### 5.4. Average Trip Duration
This chart shows us average ride duration of the users.
 
```{r tripduration, echo = FALSE, message = FALSE}
bike2019durationday %>% 
  ggplot(aes(x = days, y = average, fill = usertype)) + geom_col(position = "dodge") + 
  theme_minimal() +
  theme(
    text = element_text(family = "Courier New"),
    title = element_text(face = "bold")) + 
  labs(
    title = "\nAverage Duration Per Day",
    subtitle = "Casual vs Member User\n",
    x = "\nDays",
    y = "Average Duration (Minutes)\n",
  ) +
  guides(fill = guide_legend(title = "User")) +
  scale_fill_manual(values=c("#00CB98", "#0099cb"))
```

Although casual users use the app less frequently than annual members, they ride the bike longer. Most annual members are workers; they use Cyclistic mainly to commute to or from work. They ride bikes almost daily, but the length or duration is shorter than the casual users do. 
Casual users ride bikes for farther distance, because they pay the service for just one day or single trip, they leverage the benefits of the riding for longer time in a day.

#### 5.5. Genders
We use treemap chart to show the distribution of genders. To perform this action, we need `treemapify` package. 

```{r treemapify, include = FALSE, message = FALSE}
library(treemapify)
```
```{r treemap of genders, echo = FALSE}
bikegender %>% ggplot(aes(area = total, fill = gender, label = paste(gender, total, sep = "\n"))) + 
  geom_treemap(show.legend = FALSE) +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    family = "Roboto Black") +
  theme(legend.position = "none") +
  scale_fill_manual(values=c("#FFB1CB", "#01A6EA", "#555555")) +
  theme_minimal() +
  theme(
    text = element_text(family = "Courier New"),
    title = element_text(face = "bold"),
    strip.background = element_blank(), strip.placement = "outside") + 
  labs(
    title = "\nGenders",
    subtitle = "Casual Users and Annual Members\n") +
  facet_grid(usertype~.)
```

Both types of users have males doing more transactions than females, especially for annual members. Riding bikes is not the best option for females to commute to work because it is tiring and makes them sweat. Females pay more attention to their appearance than males. Males also work in more sectors than females. Females mostly are white-collar workers, while some males also work as blue-collar workers.

## 6. Key Findings

* Cyclistic is used mainly between April and October. Seasons affect the number of transactions. People, especially casual users, mainly use Cyclistic in spring and summer.
* Annual members use Cyclistic more often throughout the year because they pay the yearly membership. They don't want to miss their opportunity to leverage the benefits of the package they bought.
* Annual members use Cyclistic mainly on weekdays from 07:00 to 08:00 and 16:00 to 19:00, when people go to work or home. They mostly use Cyclistic for commuting.
* Casual users use the app mainly on the weekends from 09:00 to 19:00. Weekends can be the best time to ride a bike, especially for refreshing and strolling around the city.
* Both types of users have the same age distribution. Most Cyclistic users are aged between 25 - 35.
* Although casual users use the app less frequently than annual members, they ride the bike longer. Annual members mainly ride bikes for commuting, which is shorter in duration or length.
* Casual users ride bikes for longer durations or lengths. Because they pay for the service for just one day or single trip, they leverage the benefits of riding for longer periods of time in a day.
* Males have used Cyclistic more frequently than females, but casual users have the female portion slightly bigger. 

## 7. Recommendations
Here are three recommendations that marketing team can use to boost Cyclistic transaction in the future:

* Perform promotions between April and October or spring and summer. People will use Cyclistic more during those time ranges.
* Make workers the main target of promotion. They use Cyclistic more often and earn the company more money.
* Males ride bikes more often than females; the ads should be more targeted at males because they tend to easily become annual members. 


